<!DOCTYPE HTML>
<html>

  <head>
    <title>Universitas Merdeka Surabaya</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="keywords" content="Realty In Responsive web template, Bootstrap Web Templates, Flat Web Templates, Android Compatible web template,
  SmartPhone Compatible web template, free WebDesigns for Nokia, Samsung, LG, Sony Ericsson, Motorola web design" />
    <link href="css/style.css" rel="stylesheet" type="text/css" media="all" />
    <link href="css/jquery.mobile-1.4.5.min.css" rel="stylesheet" type="text/css" />
    <link href="css/bootstrap.css" rel="stylesheet" type="text/css" />
    <link href="css/chat.css" rel="stylesheet" type="text/css" />
    <link href="css/bootstrap-grid.css" rel="stylesheet" type="text/css" />
    <link href="css/bootstrap-grid.min.css" rel="stylesheet" type="text/css" />
    <link href="css/profil.css" rel="stylesheet" type="text/css" />
    <link href="css/chat.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/jquery.wmuSlider.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
  </head>

  <body>
    <style>
      .teks1 {
        font-size: 11px;
      }

      .ket {
        font-size: 9px;
      }

      .container-fluid {
        height: auto;
        min-height: 360px;
      }

      .teks2 {
        font-size: 9px;
      }

      .teks3 {
        font-size: 14px;
      }

      .kotak {
        width: auto;
        min-width: 81.5px;
      }

      .bawah {
        width: 360px;
        min-width: 360px;
      }

      .tHeader {
        font-size: 15px;
      }

      .tHeader2 {
        font-size: 11px;
      }

      .vLine {
        border-left: 1px solid white;
        height: 35px;
        position: absolute;
        left: 50%;
        margin-left: -10px;
        top: 0;
        margin-right: -10px;
      }

      .gambar {
        margin-left: -35px;
      }

      .posisi {
        margin-left: -15px;
      }

      hr.style1 {
        border-top: 1px solid #8c8b8b;
        margin-top: 5px;
        margin-bottom: 5px;
      }

      .pesan {
        margin-left: -20px;
      }

    </style>
    <header class="mhead py-0 px-0">

      <nav class="navbar fixed-bottom navbar-light bg-white py-1">
        <a class="nav-link text-center py-1 px-1" href="dashboard.html">
             <img src="images/home_active.png" style="height: 22px;"><br>
            <label class="text-orange text-12 mb-0">Home</label>
        </a>
        <a class="nav-link text-center py-1 px-1" href="personal_data.html">
            <img src="images/register (2).png" style="height: 22px;"><br>
            <label class="text-dark text-12 mb-0">Register</label>
            </a>
        <a class="nav-link text-center py-1 px-1" href="#" onclick="maintenance()">
            <img src="images/team.png" style="height: 22px;"><br>
            <label class="text-dark text-12 mb-0">Tryout</label>
        </a>
        <a class="nav-link text-center py-1 px-1" href="result.html">
            <img src="images/curriculum.png" style="height: 22px;"><br>
            <label class="text-dark text-12 mb-0">Result</label>
        </a>
        <a class="nav-link text-center py-1 px-1" href="my_account.html">
            <img src="images/my_account_hitam.png" style="height: 22px;"><br>
            <label class="text-dark text-12 mb-0">Account</label>
        </a>
    </nav>
    
    </header>
    <div class="container-fluid mt-1">
      <div class="row">
        <div class="col-2">
          <a class="navbar-brand btn text-dark ml-0 px-0" href="dashboard.html">
            <i class="fa fa-chevron-left"></i>
          </a>
        </div>
        <div class="col-10 px-0">
          <a class="btn px-4" href="#">Chat</a>
        </div>
      </div>
      <div class="row">
        <div class="col-12">
          <hr class="style1">
        </div>
      </div>
      <div class="row mb-2">
        <div class="col-12 pr-0 pl-0 mt-1">
          <div class="card-body msg_card_body" id="msg_card_body">
          </div>

          <div class="card-footer mb-5 fixed-bottom">
            <form id="send-message">
              <input type="hidden" name="sender" value="mahasiswa">
              <input type="hidden" id="mahasiswa_id" name="mahasiswa_id" value="">
              <div class="input-group">
                <!--<div class="input-group-append">
                  <span class="input-group-text attach_btn"><i class="fa fa-paperclip"></i></span>
                </div>-->
                <textarea id="message" name="message" class="form-control type_msg mt-0"
                  placeholder="Type your message..."></textarea>
                <div class="input-group-append">
                  <button type="submit" class="btn btn-success send_btn">
                    <span><i class="fa fa-location-arrow"></i></span>
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>

      <div id="master_tag" style="display: none" class="row">
        <div class="d-flex mb-4 container-message" id="container-message">
          <div id="msg-container">
            <p class="content-msg mb-0" id="content-msg"></p>
            <small class="msg_time_send mr-2"></small>
          </div>
          <div class="img_cont_msg">
            <img src="" class="rounded-circle user_img_msg">
          </div>
        </div>
      </div>
    </div>
    <br><br><br>
    <script src="js/jquery-2.2.3.min.js"></script>
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/jquery-migrate-3.0.1.min.js"></script>
    <script src="js/jquery-ui.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/bootstrap.js"></script>
    <script src="js/jquery.stellar.min.js"></script>
    <script src="js/jquery.countdown.min.js"></script>
    <script src="js/aos.js"></script>

    <script>
      $(document).ready(function () {
        get_message();
      });

      function get_message() {
        id = localStorage.getItem('id');
        $.ajax({
          type: "post",
          url: "http://localhost/unmerbaya-pmb-backend/unmer/request_get_message/get_message",
          data: {
            id: id
          },
          cache: false,
          dataType: 'json',
          success: function (data) {
            console.log(data);
            $.each(data, function (index, field) {
              tag_table = $('#master_tag').find('#container-message').clone();
              tag_table.find('#content-msg').text(field.message);
              tag_table.find('.user_img_msg').attr('src', field.img);
              tag_table.find('.msg_time_send').text(field.time);
              if(field.sender == 'mahasiswa'){
                tag_table.addClass('justify-content-end');
                tag_table.find('#msg-container').addClass('msg_container_send');
              }
              else if(field.sender == 'admin'){
                tag_table.html(field.layout);
                tag_table.find('#content-msg').text(field.message);
                tag_table.find('.msg_time_send_admin').text(field.time);
                tag_table.find('.user_img_msg').attr('src', field.img);
                tag_table.addClass('justify-content-start');
                tag_table.find('#msg-container').addClass('msg_container_reply');
                tag_table.find('#msg-container').addClass('ml-2');
              }
              $('#msg_card_body').append(tag_table);
            });
          },
          error: function () {
            alert('Network error!');
          }
        });
        return false;
      }

      $('#send-message').on('submit', function () {
        $('#mahasiswa_id').val(localStorage.getItem('id'));
        $.ajax({
          type: "post",
          url: "http://localhost/unmerbaya-pmb-backend/unmer/request_send_message/send_message",
          cache: false,
          data: new FormData($('#send-message')[0]),
          processData: false,
          contentType: false,
          dataType: "json",
          success: function (data) {
            if (data.msg == 'success') {
              location.reload();
            } else {
              alert('Message sent Failed');
            }
          },
          error: function () {
            alert('Network Error');
          }
        });
        return false;
      });

    </script>
  </body>

</html>
